# Handlebars 템플릿 작성법

## 개요

프로그래밍 기초 지식이 있는 유저를 대상으로 Handlebars Template을 직접 만드는 방법을 설명합니다.

이 문서를 Obisdian 내에서 열면, 템플릿이 적용된 화면을 같이 볼 수 있습니다.

### Handlebar Template의 목표

이 플러그인을 통해 달성하고자 하는 목표는 다음과 같습니다.

1. 꾸미기 요소가 필요한 경우 템플릿화하여 모두가 같이 사용할 수 있도록 하기
2. 템플릿 뒤로 복합한 html 태그 등을 모두 숨겨서 컨텐츠 작성자에겐 문서가 깔끔하게 보이도록 하기
3. 복잡한 데이터가 필요한 경우 `상수폴더`에 저장된 값을 이용해 자동화하기

### 기본 문법

템플릿 기본 문법은 [Handlebars 기본 문서](https://handlebarsjs.com/guide/expressions.html#basic-usage)를 참고해주세요.

## 명령어 목록

hb에서 기본으로 제공하는 함수는 `#if`, `#unless`, `#each`, `lookup`으로 매우 적어, 추가로 함수를 작성하여 넣었습니다.

1.0.0 버전 기준으로 제공되는 함수는 다음과 같으며, 실행 결과를 같이 첨부합니다.

예시 템플릿은 `예제` 이하에 있으며, 호출 예시는 본 문서의 소스보기 모드를 활용해주세요.

### 1. `#if`, `#unless`

`#if`는 조건문에 따라 보여주는 영역을 달리해주는 구문입니다.

참 거짓의 기준은 다음이 있습니다.

- 참인 경우
  - true
  - 0이 아닌 숫자
  - 아무 텍스트
  - 값이 채워진 배열(array)
  - 값이 채워진 오브젝트(object)
- 거짓인 경우
  - false
  - null
  - 값이 지정되지 않음
  - 빈 텍스트
  - 값이 채워지지 않은 배열
  - 값이 채워지지 않은 오브젝트

#### 사용법

```md
{{#if 조건}}
조건이 참일 때 문구
{{else}}
조건이 거짓일 때 문구
{{/if}}

{{#if 조건}}
조건이 참일 때 문구(거짓인 경우 생략)
{{/if}}

{{#unless 조건}}
조건이 거짓일 때 문구
{{/unless}}
```

#### if 예시

```hb
tpl: 예제/1_if
조건1: true
조건2: 아무 텍스트
```

### `#each`

`#each`는 오브젝트나 배열의 값을 하나씩 꺼내오는 명령입니다.

#### 사용법

```
{{#each 순회할목록}}

{{this}}

{{else}}
순회할 목록이 없습니다.
{{/each}}
```

```md
{{#each 순회할배열}}

  {{@index}}. {{this}}

{{else}}
순회할 배열이 없습니다.
{{/each}}
```

```md
{{#each 순회할오브젝트}}
  - {{@key}}: {{this}}
{{/each}}

{{#each 순회할오브젝트 as |키,값|}}
  - {{@키}}: {{값}}
{{/each}}
```

#### each 예시

```hb
tpl: 예제/2_each
A:
  - 0번째값
  - 1번째값
  - 2번째값
B:
  1번키: 1번값
  2번키: 2번값
  3번키: 3번값
```

### 3. `#with`

특정한 값을 `this`로 만들어주는 handlebars 기본 구문입니다.

`#with` 구문 사용시 대상이 객체라면 객체의 값들도 그대로 사용할 수 있습니다.

#### 예시
```hb
tpl: 예제/3_with

A:
  AA:
    가: 하하
    나: 후후
  BB:
    가: 호호
B: 흠

```

### 4. `if` (inline if)

기본으로 제공되는 `{{#if 조건}}`, `{{/if}}` 구문에 더해 inline if 기능이 제공됩니다.
Excel의 if문을 생각하면 빠릅니다.

#### 사용법

```
{{if 조건 참일경우 거짓일경우}}
```

#### 예시

```hb
tpl: 예제/4_inlineif
조건1: 0
참1: 0은 참이다
거짓1: 0은 거짓이다

조건2: 내용
참2: 내용이 있다
거짓2: 내용이 없다

조건3:
참3: 내용이 있다
거짓3: 내용이 없다

```

### 5. `asArray`, `asObject`

대상이 배열이나 오브젝트이면 그대로 유지하고, 아니라면 배열 또는 오브젝트로 변경해줍니다.

변수명 `내용`이 문자열이라고 할 때 다음처럼 쓸 수 있습니다.

`(asArray 값)`

```
{{#each (asArray 내용)}}
  - {{this}}
{{/each}}
```

`(asObject 값 기본키)`

```
{{#with (asObject 내용 "제목")}}
  - {{제목}}
{{/with}}
```

### 6. `isString`, `isNumber`, `isObject`, `isArray`,

타입을 확인해주는 함수입니다.

### 7. `isEmpty`

오브젝트가 배열이 '빈' 값인지 확인해줍니다.

### 8. `length`

문자열, 오브젝트, 배열의 길이(크기)를 알려줍니다.

문자열의 경우 문자 개수,
오브젝트와 배열의 경우 항목의 수를 알려줍니다.

`(length 항목)`

### 9. `eq`, `neq`

- `eq`: equal
- `neq`: not equal

두 값이 같은지를 확인하는 함수입니다.

숫자, 문자열, true/false를 검사하는데 활용하기 좋습니다.

### 10. `lt`, `lte`, `gt`, `gte`

- `lt`: lessThan
- `lte`: lessThanEquals
- `gt`: greaterThan
- `gte`: greaterThanEquals

### 11. `deepEq`, `deepNeq`

`eq`와 `neq`가 오브젝트, 배열에서는 제대로 동치여부를 확인해주지 않아 별도로 제공되는 함수입니다.

### 12. `not`

logical not 입니다.

`(not 값)`으로 사용하며

`(not (isEmpty 배열))` 형태로 응용할 수 있습니다.

### 13. `and`, `or`

`and`의 경우 모두가 참인 값인지, `or`의 경우 하나가 참인 값인지를 판단해줍니다.

`(and 값1 값2 값3 값4)`, `(or 값1 값2 값3 값4)` 형태로 사용합니다.

`and`의 경우 모두가 참이라면 가장 마지막 값을, 하나라도 거짓이면 `false`를 반환하며
`or`의 경우 하나가 참이라면 참인 첫번째 값을, 모두가 거짓이면 `false`를 반환합니다.

즉 아래처럼 사용할 수 있습니다.

```
{{#with (and "한" "국" "어")}}
{{this}}
{{/with}}

{{#with (or 0 123)}}
{{this}}
{{/with}}
```

위의 출력 결과는

```
한

123
```

가 됩니다.

### 14. `notNull`

`notNull`은 입력된 값 중, `null`이 아닌 가장 첫번째 값을 내보냅니다.

다른 언어의 null coalesce 기능에 해당합니다.

`(notNull null false)`의 결과값은 `false`가 됩니다.

### 15. `keyExists`

오브젝트에서 해당 키를 가진 값이 있는지 확인합니다.

`(keyExists 키 오브젝트)`

### 16. `contains`

오브젝트나 배열에서 해당 값을 가지고 있는지 확인합니다.

`(contains 배열 값)`

### 17. `indexOf`

오브젝트나 배열에서 해당 값을 가지고 있는 키를 돌려줍니다.

`(indexOf 값 배열)`

### 18. `noSpace`

`{{noSpace "공백이 있는 문자열"}}`

위의 결과값은 `공백이있는문자열`이 됩니다.

### 19. `concat`

`{{concat "A" "B" "C" "D"}}`

위의 결과값은 `ABCD`가 됩니다.

### 20. `repeatText`

`{{repeatText "*" 숫자}}`

### 21. `join`

`{{join (makeArray "A" "B" "C") ","}}`

배열에 포함된 문자열을 하나의 문자열로 합쳐줍니다.

### 22. `add`, `sub`, `mul`, `div`, `divInt`, `mod`, `pow`

수치 연산입니다. 숫자가 아니면 에러가 발생합니다.

- `(add 값1 값2 값3)`: 값1 + 값2 + 값3
- `(sub 값1 값2 값3)`: 값1 - 값2 - 값3
- `(mul 값1 값2 값3)`: 값1 × 값2 × 값3
- `(div 값 나눔값)`: 소수점을 포함하는 나눗셈
- `(divInt 값 나눔값)`: 소수점을 버리는 나눗셈
- `(mod 값 나눔값)`: 나머지 연산
- `(pow 값 제곱값)`: 제곱 연산

### 23. `avg`, `max`, `min`

`(avg 평균값1 평균값2 평균값3)`

`(max 최댓값1 최댓값2 최댓값3)`

`(min 최솟값1 최솟값2 최솟값3)`

### 24. `floor`, `ceil`, `round`, `abs`

`(floor 버림값)`

`(ceil 올림값)`

`(round 반올림값)`

`(abs 절댓값`

### 25. `numberFormat`

`(numberFormat 숫자 minimumFractionDigits=최소자릿수 maximumFractionDigits=최대자릿수)`

### 26. `range`

`(range 끝)`

`(range 시작 끝)`

`(range 시작 끝 단계)`

숫자로 이루어진 배열을 반환해줍니다. Python의 range 구문을 따릅니다.

예를 들어 `(range 1 5)`는 `(makeArray 1 2 3 4)`와 같습니다.

### 27. `slice`

`(slice 문자열 시작점)`

`(slice 문자열 시작점 끝점)`

`(slice 배열 시작점)`

`(slice 배열 시작점 끝점)`

문자열 혹은 배열의 중간을 잘라 반환합니다.

### 28. `merge`

`(merge 값1 값2 값3)`

- 값들이 배열인 경우: 순서대로 이어붙여 하나의 배열을 만듭니다.
- 오브젝트인 경우 하나의 오브젝트로 합칩니다.
  - 같은 키가 있는 경우, 가장 마지막 키의 값으로 대체됩니다.

### 29. `toYaml`

`{{{toYaml 값 level=숫자}}}`

`{{{toYaml 값 level=숫자 prefix="> "}}}`

`{{{toYaml 값 level=숫자 indent=2}}}`

yaml 구문으로 출력해줍니다.

디버깅 용도로 사용할 수도 있지만, 뒤에서 설명할 중첩 hb 템플릿 구문을 위해 특히 유용하게 사용할 수 있습니다.

예를 들면 이렇게 사용할 수 있습니다.

`````
{{#each 목록}}
```hb
tpl: 예제/a5_중첩_부품
이름: {{{toYaml 이름 level=1}}}
특징: {{{toYaml 특징 level=1}}}
```
{{/each}}
`````

값이 배열이나 오브젝트여도 level에 따라 적절히 처리해줍니다.

만약 `toYaml`을 callout 내에 사용한다면 prefix 옵션을 사용할 수 있습니다.

`````
> [!목록,리스트6]
{{#each 목록}}
> ```hb
> tpl: 예제/a5_중첩_부품
{{{toYaml this prefix="> "}}}
> ```
>
{{/each}}
`````

### 30. `toJson`, `fromJson`

`{{toJson 값}}`

`(fromJson 값)`

json 값을 변환하는데 사용하는 함수입니다.

### 31. `set`

`{{~set 대상 키1=값1 키2=값2~}}`

대상 scope에 값을 추가해줍니다.

만약 yaml로 표현했을 때

```yaml
A:
  가: 나다
  라: 마바
```

이고,

`{{~set A 가=12 나="다"~}}`

를 실행했다면,

```yaml
A:
  가: 12
  나: 다
  라: 마바
```

가 됩니다.

`this`, `@root`와 같이 자주 조합될 것으로 예상됩니다.

### 32. `push`, `pop`

대상이 배열인 경우 값을 추가하고 내보냅니다.

`(push 배열 값1 값2)`

`(pop 배열)`

### 33. `makeObject`

`(makeObject 키1=값1 키2=값2)`

`(makeObject 키1 값1 키2 값2 키3=값3)`

주어진 키를 이용하여 object를 만들때 사용합니다.
키를 지정하는 방법은 크게 두 가지로 `키1=값1`의 형태로 사용하거나, `키1 값1`의 형태로 띄어쓰기만 하여 이어 붙이는 방법이 있습니다. 전자의 경우 항상 문자열로 취급되므로 쌍 따옴표가 필요 없으며, 후자의 경우 문자열 키를 입력하려면 따옴표를 둘러야 합니다.

### 34. `makeArray`

`(makeArray 값1 값2 값3)`

### 35. `ignore`

`{{~ignore (아무 호출)~}}`

값을 반환하는 함수를 호출하면서 출력을 하고 싶지는 않을 때 호출합니다.

예를 들어, `{{~ignore (pop 배열)~}}`과 같은 형태로 사용하여, 배열의 값만 빼는 형태로 사용할 수 있습니다.

### 36. `del`

`{{~del 오브젝트 키~}}`

오브젝트에서 특정 키값 쌍을 제거합니다. 배열인 경우에도 숫자를 입력하면 그 숫자의 값을 제어해줍니다.

### 37. `getEnv`

`{{~getEnv 키~}}`

환경 설정에서 지정한 env 값을 조회합니다.

템플릿에서 디버그용으로 출력할 데이터를 선택한다거나, 같은 템플릿에서 스킨을 다르게 하는 등의 용도로 사용할 수 있습니다.

### 38. `replace`

`{{replace 원문 검색대상 변경대상}}`

텍스트 모두 바꾸기 기능입니다.

### 39. `escapeTemplate`

`{{escapeTempate 문자열}}`

템플릿에서 자주 사용하는 `{` `}` 문자와 겹치지 않도록, 전각 문자 버전 기호로 바꿔줍니다.

### 40. `regexp`

`(regexp 문자열)`
`(regexp 문자열 flags="regexp_flag")`

정규표현식으로 바꾸어주는 함수입니다.

`replace`, `split`, `contains`의 대상으로 사용할 수 있습니다.

### 41. `purifyName`

`(purifyName 문자열)`

특수 문자를 적절한 기호(대부분 빈칸)로 변환합니다. 내부의 데이터명을 변환하는 규칙과 같습니다.

다음은 예외입니다

- `Ⅰ`~`Ⅹ`: 1~10
- `·`: `_`
- `-_()` : 그대로 유지
- 빈칸 여러개: 빈칸 하나

---

## 특수 구문

위의 기본 handlebars 템플릿 함수에 더해 플러그인에서 제공하는 특수 구문을 소개합니다.

### A1. 추가 param

템플릿 문서 내의 frontmatter 구역에 yaml 포맷을 이용해 값을 이용하면 같이 활용할 수 있습니다.

#### A1. 예시

```hb
tpl: 예제/a1_param
이름: 홍길동
```

### A2. `prefix`

frontmatter 구역에 `prefix`를 지정하면, 결과 값의 맨 앞에 지정한 문자열이 추가됩니다.

callout 구문을 사용하는 경우에 편리합니다.

#### A2. 예시

```hb
tpl: 예제/a2_prefix
설명:
  - "\"> \"이 앞에 붙습니다.."
  - 따라서 info callout으로 해석됩니다.
```

### A3. `importParams` 기능

**추가 param**기능에 더해 다른 md 파일의 frontmatter를 param으로 가져올 수 있습니다.

가져오는 경로는 `상수`로 지정된 값을 따릅니다.

object로 지정한 경우 각각의 key에 해당하는 값을 읽어오며, array로 지정한 경우 이하의 값을 병합합니다.

importParams는 중첩도 가능합니다.

#### A3. 예시

```hb
tpl: 예제/a3_importParams
제목: 이름
```

### A4. Pence escape

템플릿 문구가 복잡해지면, 옵시디언의 미리보기 등에서 이상하게 보여주는 경우가 있습니다.

이 때 문서의 앞 뒤를 \`를 4개 이상 사용하여(pence) 둘러쌀 수 있습니다.

``````md
`````
{{#with 무언가}}
{{무언가}}
{{/with}}
`````
``````

### A5. 템플릿 중첩

hb템플릿 안에서 또 다른 hb템플릿을 불러올 수 있습니다.

#### A5. 예시

```hb
tpl: 예제/a5_중첩
목록:
  - 이름: 이순신
    특징: 장군
  - 이름: 홍길동
    특징: 의적
```
